<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CITAS VETERINARIA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body>

    <div class="modal fade" id="modalCita" tabindex="-1" aria-labelledby="modalCitaLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="formCita">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalCitaLabel">Guardar Cita</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="nombreMascota" class="form-label">Nombre de mascota</label>
                            <input type="text" class="form-control" id="nombreMascota" required>
                        </div>
                        <div class="mb-3">
                            <label for="nombrePropietario" class="form-label">Nombre propietario</label>
                            <input type="text" class="form-control" id="nombrePropietario" required>
                        </div>
                        <div class="mb-3">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="telefono" required>
                        </div>
                        <div class="mb-3">
                            <label for="fechaCita" class="form-label">Fecha de cita</label>
                            <input type="date" class="form-control" id="fechaCita" required>
                        </div>
                        <div class="mb-3">
                            <label for="horaCita" class="form-label">Hora de la cita</label>
                            <input type="time" class="form-control" id="horaCita" required>
                        </div>
                        <div class="mb-3">
                            <label for="tipoMascota" class="form-label">Tipo de mascota</label>
                            <select class="form-select" id="tipoMascota" required>
                                <option value="">Seleccione un tipo</option>
                                <option>Perro</option>
                                <option>Gato</option>
                                <option>Conejo</option>
                                <option>Hámster</option>
                                <option>Loro</option>
                                <option>Tortuga</option>
                                <option>Pez</option>
                                <option>Hurón</option>
                                <option>Vaca</option>
                                <option>Iguana</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="sintomas" class="form-label">Síntomas</label>
                            <textarea class="form-control" id="sintomas" rows="3" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <button type="button" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#modalCita">
        Nueva Cita
    </button>

    <div class="container my-4">
        <div class="row" id="citasContainer"></div>
    </div>


    <script>
        let citas = [];
        let citaEditando = null;

        function renderCitas(filtro = '', estado = '') {
            const container = document.getElementById('citasContainer');
            container.innerHTML = '';

            let citasFiltradas = citas.filter(cita => {
                const matchNombre = cita.nombreMascota.toLowerCase().includes(filtro) ||
                    cita.nombrePropietario.toLowerCase().includes(filtro);
                const matchEstado = estado ? cita.estado === estado : true;
                return matchNombre && matchEstado;
            });

            citasFiltradas.sort((a, b) => {
                const fechaA = new Date(a.fechaCita + 'T' + a.horaCita);
                const fechaB = new Date(b.fechaCita + 'T' + b.horaCita);
                return fechaA - fechaB;
            });

            for (const cita of citasFiltradas) {
                container.innerHTML += `
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">ID: ${cita.id}</h6> <!-- Línea añadida -->
                <h5 class="card-title">${cita.nombreMascota}</h5>
                <h6 class="card-subtitle mb-2 text-muted">${cita.nombrePropietario}</h6>
                <p class="card-text">
                    <b>Tel:</b> ${cita.telefono}<br>
                    <b>Fecha:</b> ${cita.fechaCita} ${cita.horaCita}<br>
                    <b>Tipo:</b> ${cita.tipoMascota}<br>
                    <b>Síntomas:</b> ${cita.sintomas}<br>
                    <b>Estado:</b> <span class="badge bg-info">${cita.estado}</span>
                </p>
                <button class="btn btn-warning btn-sm" onclick="editarCita('${cita.id}')">Editar</button>
                <button class="btn btn-danger btn-sm" onclick="confirmarEliminarCita('${cita.id}')">Eliminar</button>
            </div>
        </div>
    </div>`;
            }
        }

        function guardarCita(e) {
            e.preventDefault();

            const formData = {
                nombreMascota: document.getElementById('nombreMascota').value,
                nombrePropietario: document.getElementById('nombrePropietario').value,
                telefono: document.getElementById('telefono').value,
                fechaCita: document.getElementById('fechaCita').value,
                horaCita: document.getElementById('horaCita').value,
                tipoMascota: document.getElementById('tipoMascota').value,
                sintomas: document.getElementById('sintomas').value
            };

            if (citaEditando) {
                // Actualizar cita existente
                Object.assign(citaEditando, formData);
                console.log("Cita actualizada:", citaEditando);
                citaEditando = null;
            } else {
                // Crear nueva cita
                const nuevaCita = {
                    id: uuid.v4(),
                    ...formData,
                    estado: 'Abierta'
                };
                citas.push(nuevaCita);
                console.log("Nueva cita:", nuevaCita);
            }

            renderCitas();
            document.getElementById('formCita').reset();
            bootstrap.Modal.getInstance(document.getElementById('modalCita')).hide();
        }

        function editarCita(id) {
            citaEditando = citas.find(c => c.id === id);
            if (!citaEditando) return;

            document.getElementById('nombreMascota').value = citaEditando.nombreMascota;
            document.getElementById('nombrePropietario').value = citaEditando.nombrePropietario;
            document.getElementById('telefono').value = citaEditando.telefono;
            document.getElementById('fechaCita').value = citaEditando.fechaCita;
            document.getElementById('horaCita').value = citaEditando.horaCita;
            document.getElementById('tipoMascota').value = citaEditando.tipoMascota;
            document.getElementById('sintomas').value = citaEditando.sintomas;

            new bootstrap.Modal(document.getElementById('modalCita')).show();
        }

        function confirmarEliminarCita(id) {
            Swal.fire({
                title: '¿Eliminar cita?',
                text: "Esta acción no se puede deshacer.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    citas = citas.filter(c => c.id !== id);
                    renderCitas();
                    console.log("Cita eliminada. Citas restantes:", citas);
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('formCita').addEventListener('submit', guardarCita);

            // Limpiar la variable de edición cuando se cierra el modal
            document.getElementById('modalCita').addEventListener('hidden.bs.modal', function () {
                citaEditando = null;
            });
        });
    </script>


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuid.min.js"></script>
</body>

</html>